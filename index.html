<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTP | Editorial Flipbook Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --miku: #39c5bb; --violet: #ff007f; }
        body { 
            font-family: 'Lexend', sans-serif; background-color: #050a09; 
            color: #e6f7f6; overflow: hidden; margin: 0; user-select: none;
        }
        
        #cursor-follower { width: 20px; height: 20px; border: 2px solid var(--miku); border-radius: 50%; position: fixed; pointer-events: none; z-index: 99999; transform: translate(-50%, -50%); transition: transform 0.08s ease-out; background: linear-gradient(45deg, rgba(57, 197, 187, 0.2), rgba(255, 0, 127, 0.2)); }
        
        header { position: fixed; top: 5%; width: 100%; text-align: center; z-index: 10; }
        .title-glitch { font-size: 3rem; font-weight: 900; text-transform: uppercase; italic; letter-spacing: -2px; background: linear-gradient(90deg, var(--miku), var(--violet)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .book-wrapper {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw; perspective: 2500px;
        }

        .book { 
            position: relative; width: 450px; height: 620px; 
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            transform-style: preserve-3d;
            will-change: transform;
        }

        .page {
            position: absolute; width: 100%; height: 100%;
            top: 0; left: 0; transform-origin: left;
            transform-style: preserve-3d; 
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1), z-index 0.1s step-end;
            will-change: transform;
        }

        .front, .back {
            position: absolute; width: 100%; height: 100%;
            top: 0; left: 0; backface-visibility: hidden;
            background-color: #111;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.6);
        }

        .back { transform: rotateY(180deg); z-index: 1; }
        img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; display: block; }

        .controls-ui { position: fixed; bottom: 8%; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; z-index: 100; align-items: center; }
        .btn-mag { background: rgba(255,255,255,0.03); border: 1px solid rgba(57,197,187,0.2); color: var(--miku); padding: 12px 30px; border-radius: 8px; font-size: 10px; font-weight: 900; letter-spacing: 2px; transition: 0.3s; cursor: pointer; }
        .btn-mag:hover { border-color: var(--violet); color: white; box-shadow: 0 0 15px var(--violet); }
        .hint { font-size: 8px; color: rgba(255,255,255,0.2); text-transform: uppercase; letter-spacing: 1px; }

        .flipped { transform: rotateY(-180deg); }
    </style>
</head>
<body>
    <div id="cursor-follower"></div>

    <header>
        <h1 class="title-glitch">Editorial</h1>
        <p id="page-num" class="text-[10px] tracking-[0.4em] opacity-30 mt-2 uppercase">Page 1 / 103</p>
    </header>

    <div class="book-wrapper">
        <div id="book" class="book"></div>
    </div>

    <div class="controls-ui">
        <span class="hint">← Prev</span>
        <button id="prevBtn" class="btn-mag">PREVIOUS</button>
        <button id="nextBtn" class="btn-mag">NEXT PAGE</button>
        <span class="hint">Next →</span>
    </div>

    <script>
        const EXT = ".JPG.jpg";
        const ASSETS = ["Tạp Chí_00102"];
        for (let i = 1; i <= 100; i++) ASSETS.push(`Tạp Chí_${String(i).padStart(5, '0')}`);
        ASSETS.push("Tạp Chí_00103");

        const book = document.getElementById('book');
        const sheets = [];
        let currentIndex = 0;
        let isAnimating = false; // Chống bấm quá nhanh gây lỗi z-index

        function createBook() {
            for (let i = 0; i < ASSETS.length; i += 2) {
                const sheet = document.createElement('div');
                sheet.className = 'page';
                const baseZ = Math.floor((ASSETS.length - i) / 2);
                sheet.style.zIndex = baseZ;
                sheet.dataset.baseZ = baseZ; // Lưu lại z-index gốc

                const front = document.createElement('div');
                front.className = 'front';
                const imgF = new Image(); imgF.src = ASSETS[i] + EXT;
                front.appendChild(imgF);

                const back = document.createElement('div');
                back.className = 'back';
                if (i + 1 < ASSETS.length) {
                    const imgB = new Image(); imgB.src = ASSETS[i+1] + EXT;
                    back.appendChild(imgB);
                }

                sheet.appendChild(front);
                sheet.appendChild(back);
                book.appendChild(sheet);
                sheets.push(sheet);
            }
            updateBookPosition();
        }

        function updateBookPosition() {
            if (currentIndex === 0 || currentIndex === sheets.length) {
                book.style.transform = "translateX(0px)";
            } else {
                book.style.transform = "translateX(50%)";
            }
        }

        function next() {
            if (currentIndex < sheets.length && !isAnimating) {
                isAnimating = true;
                const sheet = sheets[currentIndex];
                sheet.classList.add('flipped');
                
                // Trì hoãn đổi z-index cho đến khi trang lật được 1 nửa (400ms)
                setTimeout(() => {
                    sheet.style.zIndex = currentIndex + 100; 
                    isAnimating = false;
                }, 400);

                currentIndex++;
                updateBookPosition();
                updateUI();
            }
        }

        function prev() {
            if (currentIndex > 0 && !isAnimating) {
                isAnimating = true;
                currentIndex--;
                const sheet = sheets[currentIndex];
                sheet.classList.remove('flipped');
                
                // Trì hoãn trả lại z-index gốc cho đến khi trang lật về 1 nửa
                setTimeout(() => {
                    sheet.style.zIndex = sheet.dataset.baseZ;
                    isAnimating = false;
                }, 400);

                updateBookPosition();
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('page-num').innerText = `Sheet ${currentIndex + 1} / ${sheets.length}`;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === "ArrowRight") next();
            if (e.key === "ArrowLeft") prev();
        });

        document.getElementById('nextBtn').onclick = next;
        document.getElementById('prevBtn').onclick = prev;

        const cursor = document.getElementById('cursor-follower');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        createBook();
    </script>
</body>
</html>
