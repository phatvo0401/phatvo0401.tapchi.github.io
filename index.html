<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTP | 3D Magazine Production</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/20.0.0/tween.umd.js"></script>
    <style>
        :root { --miku: #39c5bb; --violet: #ff007f; --glass: rgba(255, 255, 255, 0.03); --border: rgba(57, 197, 187, 0.2); }
        body { 
            font-family: 'Lexend', sans-serif; background-color: #050a09; 
            background-image: radial-gradient(at 0% 0%, rgba(255, 0, 127, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(255, 0, 127, 0.1) 0px, transparent 50%);
            background-attachment: fixed; color: #e6f7f6; overflow-x: hidden; cursor: none !important; user-select: none; 
        }
        #cursor-follower { width: 20px; height: 20px; border: 2px solid var(--miku); border-radius: 50%; position: fixed; pointer-events: none; z-index: 99999; transform: translate(-50%, -50%); background: linear-gradient(45deg, rgba(57, 197, 187, 0.2), rgba(255, 0, 127, 0.2)); }
        #magazine-view { width: 100%; height: 75vh; position: relative; }
        .controls-ui { position: absolute; bottom: 5%; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 10; }
        .btn-mag { background: var(--glass); border: 1px solid var(--border); color: var(--miku); padding: 12px 24px; border-radius: 8px; font-size: 10px; font-weight: 900; letter-spacing: 2px; transition: 0.3s; }
        .btn-mag:hover:not(:disabled) { border-color: var(--violet); color: white; box-shadow: 0 0 15px var(--violet); }
    </style>
</head>
<body>
    <div id="cursor-follower"></div>

    <header class="pt-32 text-center px-4">
        <h1 class="text-5xl font-black mb-2 uppercase italic tracking-tighter" style="background: linear-gradient(90deg, var(--miku), var(--violet)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Editorial</h1>
        <p id="status-log" class="text-white/30 font-medium tracking-[0.2em] uppercase text-[10px]">Đang kiểm tra dữ liệu hình ảnh...</p>
    </header>

    <div id="magazine-view">
        <div class="controls-ui">
            <button id="prevBtn" class="btn-mag">PREVIOUS</button>
            <button id="nextBtn" class="btn-mag">NEXT PAGE</button>
        </div>
    </div>

    <script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }</script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Danh sách tên file gốc
        const frontName = "Tạp Chí_00102";
        const backName = "Tạp Chí_00103";
        const contentPages = [];
        for (let i = 1; i <= 101; i++) contentPages.push(`Tạp Chí_${String(i).padStart(5, '0')}`);
        const ALL_NAMES = [frontName, ...contentPages, backName];

        let scene, camera, renderer, bookGroup;
        let pages = [];
        let currentPage = 0;

        function init() {
            const container = document.getElementById('magazine-view');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 75);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 2.5));
            bookGroup = new THREE.Group();
            scene.add(bookGroup);

            const loader = new THREE.TextureLoader();

            ALL_NAMES.forEach((name, i) => {
                const geometry = new THREE.BoxGeometry(16, 22, 0.05);
                geometry.translate(8, 0, 0);

                // --- LOGIC TỰ ĐỘNG DÒ ĐUÔI FILE ---
                const extensions = [".JPG.jpg", ".jpg", ".JPG", ".jpeg"];
                let tex = new THREE.Texture();

                const tryLoad = (extIndex) => {
                    if (extIndex >= extensions.length) {
                        if(i === 0) document.getElementById('status-log').innerText = "KHÔNG TÌM THẤY ẢNH TRONG THƯ MỤC!";
                        return;
                    }
                    
                    const fullPath = name + extensions[extIndex];
                    loader.load(
                        fullPath,
                        (loadedTex) => {
                            // Thành công
                            pages[i].material[4].map = loadedTex;
                            pages[i].material[4].needsUpdate = true;
                            if(i === 0) document.getElementById('status-log').innerText = "Đã nhận diện: " + extensions[extIndex];
                        },
                        undefined,
                        () => tryLoad(extIndex + 1) // Thất bại, thử đuôi tiếp theo
                    );
                };

                const materials = [
                    new THREE.MeshPhongMaterial({ color: 0x111111 }),
                    new THREE.MeshPhongMaterial({ color: 0x111111 }),
                    new THREE.MeshPhongMaterial({ color: 0x111111 }),
                    new THREE.MeshPhongMaterial({ color: 0x111111 }),
                    new THREE.MeshPhongMaterial({ map: tex }), // Sẽ được cập nhật sau khi load thành công
                    new THREE.MeshPhongMaterial({ color: (i === ALL_NAMES.length-1) ? 0x050505 : 0xffffff })
                ];

                const page = new THREE.Mesh(geometry, materials);
                page.position.z = - (i < 6 ? i * 0.08 : 6 * 0.08);
                page.visible = (i < 3);
                pages.push(page);
                bookGroup.add(page);

                tryLoad(0); // Bắt đầu dò từ đuôi đầu tiên (.JPG.jpg)
            });

            bookGroup.position.x = -8;
            new OrbitControls(camera, renderer.domElement);
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            renderer.render(scene, camera);
        }

        window.nextPage = () => {
            if (currentPage < ALL_NAMES.length - 1) {
                new TWEEN.Tween(pages[currentPage].rotation).to({ y: -Math.PI + 0.04 }, 800).easing(TWEEN.Easing.Quartic.InOut).start();
                currentPage++;
                pages.forEach((p, i) => p.visible = (i >= currentPage - 1 && i <= currentPage + 1));
                new TWEEN.Tween(bookGroup.position).to({ x: (currentPage === 0 ? -8 : 0) }, 600).start();
            }
        };

        window.prevPage = () => {
            if (currentPage > 0) {
                currentPage--;
                new TWEEN.Tween(pages[currentPage].rotation).to({ y: 0 }, 800).easing(TWEEN.Easing.Quartic.InOut).start();
                pages.forEach((p, i) => p.visible = (i >= currentPage - 1 && i <= currentPage + 1));
                new TWEEN.Tween(bookGroup.position).to({ x: (currentPage === 0 ? -8 : 0) }, 600).start();
            }
        };

        document.getElementById('nextBtn').onclick = window.nextPage;
        document.getElementById('prevBtn').onclick = window.prevPage;

        const cursor = document.getElementById('cursor-follower');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
        });

        init();
    </script>
</body>
</html>
